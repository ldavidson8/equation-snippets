---
import Footer from '@/components/Footer.astro'
import Header from '@/components/Header.astro'
import Head from '@/components/Head.astro'
import 'katex/dist/katex.min.css'
import { pwaInfo } from 'virtual:pwa-info'
import '@oddbird/popover-polyfill'

type Props = {
  title: string
  siteName?: string
  description: string
  cover: string
  author?: string
}

const { title, siteName, description, cover, author } = Astro.props
---

<!doctype html>
<html class="bg-secondary text-primary flex min-h-screen flex-col font-sans" lang="en">
  <head>
    <Head
      title={title}
      siteName={siteName}
      description={description}
      cover={cover}
      author={author}
    />
    <script is:inline>
      ;(function () {
        const root = document.documentElement

        function applyTheme() {
          const theme = localStorage.getItem('theme') || 'system'
          const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isDark = theme === 'dark' || (theme === 'system' && systemDark)

          if (isDark) {
            root.classList.add('dark')
          } else {
            root.classList.remove('dark')
          }
        }

        applyTheme()

        document.addEventListener('theme-change', applyTheme)

        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', applyTheme)
      })()
    </script>
    {pwaInfo && <Fragment set:html={pwaInfo.webManifest.linkTag} />}
    <script src="/src/pwa.ts"></script>
  </head>
  <body>
    <Header />
    <main>
      <div>
        <slot />
      </div>
    </main>
    <Footer />
  </body>
</html>
